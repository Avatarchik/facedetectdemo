!function(){function e(){function e(){var e=s,t=e.getImageData(0,0,l.width,l.height);return t}function a(){var t=cv.matFromArray(e(),24),a=new cv.Mat,i=new cv.Mat;cv.cvtColor(t,a,cv.ColorConversionCodes.COLOR_RGBA2GRAY.value,0),cv.cvtColor(t,i,cv.ColorConversionCodes.COLOR_RGBA2RGB.value,0);var d=new cv.RectVector,o=[0,0],r=[0,0];n.detectMultiScale(a,d,1.1,3,0,o,r);for(var l=0;l<d.size();l+=1){var s=d.get(l);x=s.x,y=s.y,w=s.width,h=s.height;var v=[x,y],m=[x+w,y+h],u=new cv.Scalar(255,0,0),g=new cv.Scalar(0,255,0);cv.rectangle(i,v,m,u,2,8,0);var f=new cv.Rect(x,y,w,h),C=a.getROI_Rect(f),R=i.getROI_Rect(f),I=new cv.RectVector;c.detectMultiScale(C,I,1.1,3,0,o,r);for(var D=0;D<I.size();D+=1){var _=I.get(D),v=[x+_.x,y+_.y],m=[x+_.x+_.width,y+_.y+_.height];cv.rectangle(i,v,m,g,2,8,0)}I["delete"](),s["delete"](),u["delete"](),g["delete"](),C["delete"](),R["delete"]()}show_image(i,"canvas2"),t["delete"](),i["delete"](),d["delete"](),a["delete"]()}var n=new cv.CascadeClassifier;n.load("../../test/data/haarcascade_frontalface_default.xml");var c=new cv.CascadeClassifier;c.load("../../test/data/haarcascade_eye.xml");var i;const d=320,o=240,r=1e3/30;var l=document.getElementById("canvas1");l.width=d,l.height=o;var s=l.getContext("2d");show_image=function(e,t){var a=e.data();channels=e.channels(),channelSize=e.elemSize1();var n=document.getElementById(t);ctx=n.getContext("2d"),ctx.clearRect(0,0,n.width,n.height),n.width=e.cols,n.height=e.rows,imdata=ctx.createImageData(e.cols,e.rows);for(var c=0,i=0;c<a.length;c+=channels,i+=4)imdata.data[i]=a[c],imdata.data[i+1]=a[c+1%channels],imdata.data[i+2]=a[c+2%channels],imdata.data[i+3]=255;ctx.putImageData(imdata,0,0)};var v=function(){setInterval(function(){s.drawImage(i,0,0,d,o),a()},r),document.getElementById("loading").style="display: none;",document.getElementById("text").style="display: block;",document.getElementById("stop").addEventListener("click",function(){i.srcObject=null})};i=t(v)}function t(e){const t=640,a=480;var n=document.createElement("video");return n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.setAttribute("playsinline",""),n.style.width="640px",n.style.height="480px",(void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.enumerateDevices||void 0===navigator.mediaDevices.getUserMedia)&&alert("WebRTC issue! navigator.mediaDevices.enumerateDevices not present in your browser"),navigator.mediaDevices.enumerateDevices().then(function(){var c={audio:!1,video:{facingMode:"environment",width:{ideal:t},height:{ideal:a}}};navigator.mediaDevices.getUserMedia(c).then(function(t){n.srcObject=t,document.body.addEventListener("click",function(){n.play()});var a=setInterval(function(){n.videoWidth&&(e(),clearInterval(a))},20)})["catch"](function(e){console.log("Can't access user media",e),alert("Can't access camera")})})["catch"](function(e){console.log(e.name+": "+e.message)}),n}ON_OPENCV_READY=e}();